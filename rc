
language C

" Not VI compatible.
set nocompatible

" No wrapping.
set nowrap

" Show line numbers.
set number
set numberwidth=5

" Allow backspacing over everything in insert mode.
set backspace=2

" Use status line to display possible completions.
set wildmenu
set wildmode=list:longest,full

" Change the select/visual mode behavior.
behave xterm
set selectmode=key
set keymodel=startsel

" Syntax highlighting.
syntax on

" Load specific term keys setting.
" Needed for some mappings to work properly.
if !has("gui_running")
  let keys=$USERVIM."/keys/".$TERM
  if filereadable(keys)
    execute "source " . keys
  endif
endif

" Improved completion.

set complete=.,t,i,k

function! CleverTab()
  let to_pos=strpart(getline('.'), 0, col('.') - 1 )
  let from_pos=strpart(getline('.'), col('.') - 2, col('$'))
  if to_pos =~ '^\s*#\s*include'
    if to_pos =~ '^\s*#\s*include\s*$'
      return " \"\<C-X>\<C-F>\"\<Left>"
    endif
    return "\<C-X>\<C-F>"
  elseif from_pos =~ '^\k'
    return "\<C-P>"
  endif
  return "\<Tab>"
endfunction
inoremap <Tab> <C-R>=CleverTab()<CR>

function! SCleverTab()
  let to_pos=strpart(getline('.'), 0, col('.') - 1 )
  let from_pos=strpart(getline('.'), col('.') - 2, col('$'))
  if from_pos =~ '^\k'
    return "\<C-N>"
  endif
  return "\<Tab>"
endfunction
inoremap <S-Tab> <C-R>=SCleverTab()<CR>

inoremap <C-]> <C-x><C-]>
inoremap <C-f> <C-x><C-f>
inoremap <C-d> <C-x><C-d>
inoremap <C-l> <C-x><C-l>
inoremap <C-k> <C-x><C-k>

" vim: ft=vim sw=2
